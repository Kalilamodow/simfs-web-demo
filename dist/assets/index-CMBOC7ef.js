var q=Object.defineProperty;var Z=(s,e,t)=>e in s?q(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var S=(s,e,t)=>(Z(s,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(i){if(i.ep)return;i.ep=!0;const c=t(i);fetch(i.href,c)}})();function I(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var x={exports:{}};x.exports;(function(s){var e=function(){var t=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",c={};function l(n,f){if(!c[n]){c[n]={};for(var h=0;h<n.length;h++)c[n][n.charAt(h)]=h}return c[n][f]}var d={compressToBase64:function(n){if(n==null)return"";var f=d._compress(n,6,function(h){return r.charAt(h)});switch(f.length%4){default:case 0:return f;case 1:return f+"===";case 2:return f+"==";case 3:return f+"="}},decompressFromBase64:function(n){return n==null?"":n==""?null:d._decompress(n.length,32,function(f){return l(r,n.charAt(f))})},compressToUTF16:function(n){return n==null?"":d._compress(n,15,function(f){return t(f+32)})+" "},decompressFromUTF16:function(n){return n==null?"":n==""?null:d._decompress(n.length,16384,function(f){return n.charCodeAt(f)-32})},compressToUint8Array:function(n){for(var f=d.compress(n),h=new Uint8Array(f.length*2),o=0,u=f.length;o<u;o++){var g=f.charCodeAt(o);h[o*2]=g>>>8,h[o*2+1]=g%256}return h},decompressFromUint8Array:function(n){if(n==null)return d.decompress(n);for(var f=new Array(n.length/2),h=0,o=f.length;h<o;h++)f[h]=n[h*2]*256+n[h*2+1];var u=[];return f.forEach(function(g){u.push(t(g))}),d.decompress(u.join(""))},compressToEncodedURIComponent:function(n){return n==null?"":d._compress(n,6,function(f){return i.charAt(f)})},decompressFromEncodedURIComponent:function(n){return n==null?"":n==""?null:(n=n.replace(/ /g,"+"),d._decompress(n.length,32,function(f){return l(i,n.charAt(f))}))},compress:function(n){return d._compress(n,16,function(f){return t(f)})},_compress:function(n,f,h){if(n==null)return"";var o,u,g={},A={},b="",k="",w="",_=2,E=3,v=2,y=[],a=0,p=0,m;for(m=0;m<n.length;m+=1)if(b=n.charAt(m),Object.prototype.hasOwnProperty.call(g,b)||(g[b]=E++,A[b]=!0),k=w+b,Object.prototype.hasOwnProperty.call(g,k))w=k;else{if(Object.prototype.hasOwnProperty.call(A,w)){if(w.charCodeAt(0)<256){for(o=0;o<v;o++)a=a<<1,p==f-1?(p=0,y.push(h(a)),a=0):p++;for(u=w.charCodeAt(0),o=0;o<8;o++)a=a<<1|u&1,p==f-1?(p=0,y.push(h(a)),a=0):p++,u=u>>1}else{for(u=1,o=0;o<v;o++)a=a<<1|u,p==f-1?(p=0,y.push(h(a)),a=0):p++,u=0;for(u=w.charCodeAt(0),o=0;o<16;o++)a=a<<1|u&1,p==f-1?(p=0,y.push(h(a)),a=0):p++,u=u>>1}_--,_==0&&(_=Math.pow(2,v),v++),delete A[w]}else for(u=g[w],o=0;o<v;o++)a=a<<1|u&1,p==f-1?(p=0,y.push(h(a)),a=0):p++,u=u>>1;_--,_==0&&(_=Math.pow(2,v),v++),g[k]=E++,w=String(b)}if(w!==""){if(Object.prototype.hasOwnProperty.call(A,w)){if(w.charCodeAt(0)<256){for(o=0;o<v;o++)a=a<<1,p==f-1?(p=0,y.push(h(a)),a=0):p++;for(u=w.charCodeAt(0),o=0;o<8;o++)a=a<<1|u&1,p==f-1?(p=0,y.push(h(a)),a=0):p++,u=u>>1}else{for(u=1,o=0;o<v;o++)a=a<<1|u,p==f-1?(p=0,y.push(h(a)),a=0):p++,u=0;for(u=w.charCodeAt(0),o=0;o<16;o++)a=a<<1|u&1,p==f-1?(p=0,y.push(h(a)),a=0):p++,u=u>>1}_--,_==0&&(_=Math.pow(2,v),v++),delete A[w]}else for(u=g[w],o=0;o<v;o++)a=a<<1|u&1,p==f-1?(p=0,y.push(h(a)),a=0):p++,u=u>>1;_--,_==0&&(_=Math.pow(2,v),v++)}for(u=2,o=0;o<v;o++)a=a<<1|u&1,p==f-1?(p=0,y.push(h(a)),a=0):p++,u=u>>1;for(;;)if(a=a<<1,p==f-1){y.push(h(a));break}else p++;return y.join("")},decompress:function(n){return n==null?"":n==""?null:d._decompress(n.length,32768,function(f){return n.charCodeAt(f)})},_decompress:function(n,f,h){var o=[],u=4,g=4,A=3,b="",k=[],w,_,E,v,y,a,p,m={val:h(0),position:f,index:1};for(w=0;w<3;w+=1)o[w]=w;for(E=0,y=Math.pow(2,2),a=1;a!=y;)v=m.val&m.position,m.position>>=1,m.position==0&&(m.position=f,m.val=h(m.index++)),E|=(v>0?1:0)*a,a<<=1;switch(E){case 0:for(E=0,y=Math.pow(2,8),a=1;a!=y;)v=m.val&m.position,m.position>>=1,m.position==0&&(m.position=f,m.val=h(m.index++)),E|=(v>0?1:0)*a,a<<=1;p=t(E);break;case 1:for(E=0,y=Math.pow(2,16),a=1;a!=y;)v=m.val&m.position,m.position>>=1,m.position==0&&(m.position=f,m.val=h(m.index++)),E|=(v>0?1:0)*a,a<<=1;p=t(E);break;case 2:return""}for(o[3]=p,_=p,k.push(p);;){if(m.index>n)return"";for(E=0,y=Math.pow(2,A),a=1;a!=y;)v=m.val&m.position,m.position>>=1,m.position==0&&(m.position=f,m.val=h(m.index++)),E|=(v>0?1:0)*a,a<<=1;switch(p=E){case 0:for(E=0,y=Math.pow(2,8),a=1;a!=y;)v=m.val&m.position,m.position>>=1,m.position==0&&(m.position=f,m.val=h(m.index++)),E|=(v>0?1:0)*a,a<<=1;o[g++]=t(E),p=g-1,u--;break;case 1:for(E=0,y=Math.pow(2,16),a=1;a!=y;)v=m.val&m.position,m.position>>=1,m.position==0&&(m.position=f,m.val=h(m.index++)),E|=(v>0?1:0)*a,a<<=1;o[g++]=t(E),p=g-1,u--;break;case 2:return k.join("")}if(u==0&&(u=Math.pow(2,A),A++),o[p])b=o[p];else if(p===g)b=_+_.charAt(0);else return null;k.push(b),o[g++]=_+b.charAt(0),u--,_=b,u==0&&(u=Math.pow(2,A),A++)}}};return d}();s!=null?s.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})})(x);var H=x.exports;class J extends Error{}class G extends Error{}class K extends Error{}class R{constructor(e,t,r){S(this,"name");S(this,"parentDir");S(this,"contents");S(this,"type","file");this.name=e,typeof t=="string"&&(t=new Uint8Array(t.split("").map(i=>i.charCodeAt(0)))),this.contents=t||new Uint8Array,this.parentDir=r}delete(){if(this.parentDir)this.parentDir.delete(this.name);else throw new G("No parent provided when creating file")}write(e){this.contents=typeof e=="string"?new Uint8Array(e.split("").map(t=>t.charCodeAt(0))):e}read(){return new TextDecoder().decode(this.contents)}serialize(){return R.serialize(this)}static serialize(e){const t=e.name.length,r=e.name.split("").map(i=>i.charCodeAt(0));return new Uint8Array([1].concat([t]).concat(r).concat([e.contents.byteLength]).concat(Array.from(e.contents)))}}class O{constructor(e,t){S(this,"name");S(this,"contents");S(this,"parentDir");S(this,"type","directory");this.name=e,this.parentDir=t,this.contents=[]}delete(e){const t=this.contents.filter(r=>r.name!=e);if(t===this.contents)throw new J;this.contents=t}deleteSelf(){if(!this.parentDir)throw new G("No parent provided, or root directory");this.parentDir.delete(this.name)}addFile(e,t=!0){if(this.contents.map(r=>r.name).includes(e.name))throw new K("Cannot add file, as it already exists");return t&&(e.parentDir=this),this.contents.push(e),e}createFile(e,t){const r=new R(e,t,this);return this.addFile(r),r}createDirectory(e){const t=new O(e,this);return this.contents.push(t),t}get(e,t){if(!e)return this.contents;const r=this.contents.find(i=>i.name==e);if(!r)return null;if(t){if(r.type=="file"&&t=="file"||r.type=="directory"&&t=="directory")return r;throw new TypeError("Predefined type does not match resource type")}return r}serialize(){return O.serialize(this)}static serialize(e){const t=[2],r=e.name.length;t.push(r);const i=e.name.split("").map(l=>l.charCodeAt(0));t.push(...i);const c=[];return e.contents.forEach(l=>{const d=l.serialize();c.push(...d)}),t.push(c.length),t.push(...c),new Uint8Array(t)}}var T;(function(s){s[s.RES_TYPE=0]="RES_TYPE",s[s.NAME_LENGTH=1]="NAME_LENGTH",s[s.NAME=2]="NAME",s[s.CONTENT_LENGTH=3]="CONTENT_LENGTH",s[s.FILE_CONTENT=4]="FILE_CONTENT"})(T||(T={}));function C(s,...e){console.log("x"+s.toString(16).padStart(2,"0"),"	",...e)}function $(s){const e=new O("",void 0);let t,r,i="directory";const c=[];let l,d,n=T.RES_TYPE;H.decompress(s).split(",").map(o=>parseInt(o)).forEach((o,u)=>{const g=o;switch(n){case T.RES_TYPE:g==1?(C(u,"found file"),t?r=t.createFile(""):r=e.createFile(""),i="file"):(C(u,"found directory"),t?t=t.createDirectory(""):t=e.createDirectory(""),i="directory"),n=T.NAME_LENGTH;break;case T.NAME_LENGTH:if(C(u,"found name length x"+g.toString(16)),d=g,n=T.NAME,d==0){d=void 0,C(u,"name length started at 0, jumping to content length immediately"),n=T.CONTENT_LENGTH;break}break;case T.NAME:if(i=="file"?r.name+=String.fromCharCode(g):t.name+=String.fromCharCode(g),d--,d<=0){d=void 0,C(u,`left_in_name < i0, jumping to content length. name found: ${i=="file"?r.name:t.name}`),n=T.CONTENT_LENGTH;break}break;case T.CONTENT_LENGTH:if(i=="file")C(u,"found content length of file x"+g.toString(16)),l=g;else{c.push(g),C(u,"found content length of dir x"+g.toString(16)),n=T.RES_TYPE;break}n=T.FILE_CONTENT;break;case T.FILE_CONTENT:if(r.write(new Uint8Array(Array.from(r.contents).concat([g]))),l--,c[c.length-1]--,l<=0){if(l=void 0,C(u,"left in file contents is 0, going to next file. text found: "+r.read()),c[c.length-1]<=0){C(u,"left_in_dir_contents is 0, jumping to next directory"),c.pop(),t=t.parentDir,n=T.RES_TYPE;break}n=T.RES_TYPE;break}}});const h=e.contents[0];return h.parentDir=void 0,new z(h)}function N(s){if(typeof s!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(s))}function U(s,e){for(var t="",r=0,i=-1,c=0,l,d=0;d<=s.length;++d){if(d<s.length)l=s.charCodeAt(d);else{if(l===47)break;l=47}if(l===47){if(!(i===d-1||c===1))if(i!==d-1&&c===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var n=t.lastIndexOf("/");if(n!==t.length-1){n===-1?(t="",r=0):(t=t.slice(0,n),r=t.length-1-t.lastIndexOf("/")),i=d,c=0;continue}}else if(t.length===2||t.length===1){t="",r=0,i=d,c=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+s.slice(i+1,d):t=s.slice(i+1,d),r=d-i-1;i=d,c=0}else l===46&&c!==-1?++c:c=-1}return t}function Q(s,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+s+r:r}var D={resolve:function(){for(var e="",t=!1,r,i=arguments.length-1;i>=-1&&!t;i--){var c;i>=0?c=arguments[i]:(r===void 0&&(r=process.cwd()),c=r),N(c),c.length!==0&&(e=c+"/"+e,t=c.charCodeAt(0)===47)}return e=U(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(N(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=U(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return N(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];N(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":D.normalize(e)},relative:function(e,t){if(N(e),N(t),e===t||(e=D.resolve(e),t=D.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var i=e.length,c=i-r,l=1;l<t.length&&t.charCodeAt(l)===47;++l);for(var d=t.length,n=d-l,f=c<n?c:n,h=-1,o=0;o<=f;++o){if(o===f){if(n>f){if(t.charCodeAt(l+o)===47)return t.slice(l+o+1);if(o===0)return t.slice(l+o)}else c>f&&(e.charCodeAt(r+o)===47?h=o:o===0&&(h=0));break}var u=e.charCodeAt(r+o),g=t.charCodeAt(l+o);if(u!==g)break;u===47&&(h=o)}var A="";for(o=r+h+1;o<=i;++o)(o===i||e.charCodeAt(o)===47)&&(A.length===0?A+="..":A+="/..");return A.length>0?A+t.slice(l+h):(l+=h,t.charCodeAt(l)===47&&++l,t.slice(l))},_makeLong:function(e){return e},dirname:function(e){if(N(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,i=-1,c=!0,l=e.length-1;l>=1;--l)if(t=e.charCodeAt(l),t===47){if(!c){i=l;break}}else c=!1;return i===-1?r?"/":".":r&&i===1?"//":e.slice(0,i)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');N(e);var r=0,i=-1,c=!0,l;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var d=t.length-1,n=-1;for(l=e.length-1;l>=0;--l){var f=e.charCodeAt(l);if(f===47){if(!c){r=l+1;break}}else n===-1&&(c=!1,n=l+1),d>=0&&(f===t.charCodeAt(d)?--d===-1&&(i=l):(d=-1,i=n))}return r===i?i=n:i===-1&&(i=e.length),e.slice(r,i)}else{for(l=e.length-1;l>=0;--l)if(e.charCodeAt(l)===47){if(!c){r=l+1;break}}else i===-1&&(c=!1,i=l+1);return i===-1?"":e.slice(r,i)}},extname:function(e){N(e);for(var t=-1,r=0,i=-1,c=!0,l=0,d=e.length-1;d>=0;--d){var n=e.charCodeAt(d);if(n===47){if(!c){r=d+1;break}continue}i===-1&&(c=!1,i=d+1),n===46?t===-1?t=d:l!==1&&(l=1):t!==-1&&(l=-1)}return t===-1||i===-1||l===0||l===1&&t===i-1&&t===r+1?"":e.slice(t,i)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return Q("/",e)},parse:function(e){N(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),i=r===47,c;i?(t.root="/",c=1):c=0;for(var l=-1,d=0,n=-1,f=!0,h=e.length-1,o=0;h>=c;--h){if(r=e.charCodeAt(h),r===47){if(!f){d=h+1;break}continue}n===-1&&(f=!1,n=h+1),r===46?l===-1?l=h:o!==1&&(o=1):l!==-1&&(o=-1)}return l===-1||n===-1||o===0||o===1&&l===n-1&&l===d+1?n!==-1&&(d===0&&i?t.base=t.name=e.slice(1,n):t.base=t.name=e.slice(d,n)):(d===0&&i?(t.name=e.slice(1,l),t.base=e.slice(1,n)):(t.name=e.slice(d,l),t.base=e.slice(d,n)),t.ext=e.slice(l,n)),d>0?t.dir=e.slice(0,d-1):i&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};D.posix=D;var W=D;const M=I(W);class z{constructor(e){S(this,"root");S(this,"cwd_path");typeof e=="string"&&(e=$(e).root),this.root=e||new O(""),this.cwd_path="/"}cd(e){let t=this.cwd_path;e.forEach(i=>t=M.join(t,i));const r=this.get_by_path(t);return!r||r.type=="file"?!1:(this.cwd_path=t,!0)}cwd(){return this.get_by_path(this.cwd_path)}get_by_path(e){let t=this.root;const r=M.normalize(e).split(M.sep).toSpliced(0,1);if(JSON.stringify(r)==JSON.stringify([""]))return this.root;for(let i=0;i<r.length;i++){const c=r[i],l=t.get(c);if(!l)return null;if(l.type=="file")return l;t=l}return t}serialize(){const e=this.root.serialize().join(",");return H.compress(e)}}let L=new z;function B(){const s=L.cwd();document.getElementById("current-working-directory").innerText=L.cwd_path+(L.cwd_path!="/"?"/":"");const e=[];L.cwd_path!="/"&&e.push({type:"directory",name:"..",displayName:"back"}),s.get().forEach(r=>{e.push({type:r.type,name:r.name,displayName:r.type=="directory"?`${r.name}/`:r.name})});const t=document.getElementById("directory-listing");t.innerHTML="",e.forEach(r=>{const i=document.createElement("div");i.setAttribute("data-type",r.type),i.innerText=r.displayName,r.type=="directory"?i.addEventListener("click",()=>{L.cd([r.name]),document.getElementById("file-editor-ctr").hidden=!0,B()}):i.addEventListener("click",()=>X(s.get(r.name,"file"))),t.appendChild(i)})}function X(s){const e=document.getElementById("file-editor-ctr"),t=e.querySelector("#file-editor-input");t.value=s.read(),Array.from(e.children).at(-1).remove();const r=document.createElement("button");r.type="button",r.innerText="Save",r.onclick=()=>{s.write(t.value),t.value="",e.hidden=!0},e.appendChild(r),e.children[0].innerText=s.name,e.hidden=!1}function Y(s){const e=prompt("Name of new "+s);if(e){if(L.cwd().get(e)){alert("Already exists");return}s=="file"?L.cwd().createFile(e):L.cwd().createDirectory(e)}}function V(){const s=L.serialize(),e=new Blob([s],{type:"application/octet-stream"}),t=document.createElement("a");t.download="filesystem.simfs",t.href=URL.createObjectURL(e),t.style.display="none",document.body.appendChild(t),t.click(),t.remove()}function ee(){const s=document.createElement("input");s.type="file",s.accept="*.simfs",s.onchange=()=>{const e=s.files;if(!e)return;const t=e[0];t&&(t.text().then(r=>{L=new z(r),B()}),s.remove())},s.click()}B();document.querySelector("#cwd-buttons>button:first-child").addEventListener("click",()=>Y("file"));document.querySelector("#cwd-buttons>button:last-child").addEventListener("click",()=>Y("directory"));var j;(j=document.getElementById("save-fs"))==null||j.addEventListener("click",V);var P;(P=document.getElementById("load-fs"))==null||P.addEventListener("click",ee);var F;(F=document.getElementById("clear-fs"))==null||F.addEventListener("click",()=>{confirm("Are you sure?")&&(L=new z)});
